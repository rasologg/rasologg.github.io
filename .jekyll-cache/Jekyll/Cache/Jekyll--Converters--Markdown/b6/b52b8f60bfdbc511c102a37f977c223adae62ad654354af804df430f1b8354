I"¨a<h1 id="introduction">Introduction</h1>

<p>Maven (plus precisement Apache Maven) est un outil de gestion de dÃ©pendances en Java. Mais il permet aussi dâ€™automatiser differentes Ã©tapes utiles pendant un developpement logiciel : tests et qualitÃ©, compilation, packaging, archivage et documentation.</p>

<p>De maniÃ¨re generale, une application Ã©crite en Java, par exemple un microservice, a besoin dâ€™utiliser une base de donnÃ©es, de lancer un serveur web HTTP ou dâ€™effectuer des calculs, etcâ€¦.</p>

<p>Pas besoin de rÃ©inventer la roue, quelquâ€™un a dÃ©jÃ  fait le travail Ã  notre place et a publiÃ© ses projets sur Internet, câ€™est la magie de lâ€™Open Source.</p>

<p>Pour rÃ©utiliser ces composants Open Source dans notre projet, on a besoin dâ€™un outil comme Maven. Il nous aide Ã  rÃ©soudre beaucoup de problÃ©matiques comme la compatibilitÃ© des versions, lâ€™inter-dependance entre composants, etcâ€¦</p>

<p>Dans le monde Java, il y a trois principaux outils pour gÃ©rer les dependances :</p>

<ul>
  <li><a href="https://maven.apache.org">Apache Maven</a></li>
  <li><a href="https://gradle.org/">Gradle</a></li>
  <li><a href="https://ant.apache.org/">Apache Ant</a></li>
</ul>

<p>Apache Maven reste le plus populaire et le plus utilisÃ© mÃªme si Gradle monte en puissance.</p>

<p>Apache Maven a commencÃ© en 2002, trÃ¨s stable, robuste et supportÃ© par la majoritÃ© des IDEs (Intellij, Eclipse, â€¦), il est aussi utilisÃ© par quasiment tous les projets Open Source.</p>

<h1 id="installation">Installation</h1>

<p>En tant que DÃ©veloppeur, on utilise trÃ¨s souvent plusieurs outils et en plusieurs versions. Pour faciliter lâ€™installation et la gestion de ces outils, on peut utiliser <a href="https://sdkman.io/">SDK Man</a>.</p>

<p>La procedure Ã  suivre pour installer SDKMan est disponible Ã  lâ€™adresse suivante https://sdkman.io/install.</p>

<p>Une fois SDKMan est installÃ©, lancÃ© la commande suivante pour installer Java JDK (sâ€™il nâ€™est pas dÃ©jÃ  installÃ© sur votre ordinateur) :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sdk install java 11.0.10.hs-adpt
</code></pre></div></div>

<p>La 11.0.10.hs-adpt est la derniere version de OpenJDK11 disponible sur la plateforme sdkman au moment oÃ¹ jâ€™Ã©cris cet article mais vous pouvez afficher la derniÃ¨re version via la commande :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sdk ls java
</code></pre></div></div>

<p>AprÃ¨s avoir installÃ© Java, voici la commande pour installer Maven :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sdk install maven
</code></pre></div></div>

<p>A noter que Maven est integrÃ© par dÃ©faut dans lâ€™IDE comme Intellij, Eclipse. On peut lâ€™utiliser directement mais personnelement je prefere utiliser la ligne de commande et avoir une installation Ã  lâ€™exterieur de lâ€™IDE.</p>

<p>Pour vÃ©rifier que lâ€™installation a bien fonctionnÃ© :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn --version
</code></pre></div></div>

<p>Le rÃ©sultat devrait afficher la version de Maven et son emplacement.</p>

<h1 id="crÃ©er-un-projet-java-via-maven">CrÃ©er un projet Java via Maven</h1>

<p>On peut crÃ©er un projet Java/Maven via un IDE type Intellij ou Eclipse, mais pour comprendre le fonctionnement, on va dâ€™abord crÃ©er un projet Maven via la ligne commande :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn archetype:generate -DgroupId=io.rasologg.tutoriel -DartifactId=java-maven-project -DarchetypeArtifactId=maven-archetype-quickstart -DinteractiveMode=false
</code></pre></div></div>

<p>Si tout va bien, des fichiers seront tÃ©lÃ©chargÃ©s et Maven va crÃ©er un le projet contenant structurÃ© comme ci-dessous :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>java-maven-project
â”œâ”€â”€ pom.xml
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚Â Â  â””â”€â”€ java
    â”‚Â Â      â””â”€â”€ io
    â”‚Â Â          â””â”€â”€ rasologg
    â”‚Â Â              â””â”€â”€ tutoriel
    â”‚Â Â                  â””â”€â”€ App.java
    â””â”€â”€ test
        â””â”€â”€ java
            â””â”€â”€ io
                â””â”€â”€ rasologg
                    â””â”€â”€ tutoriel
                        â””â”€â”€ AppTest.java
</code></pre></div></div>
<h2 id="archetype">Archetype</h2>

<p>Simplement un template de projet, ici on utilise â€œmaven-archetype-quickstartâ€ est genere un projet Java trÃ¨s basique Ã  partir du template. On peut trouver une liste des archetypes inclus par dÃ©faut dans Maven https://maven.apache.org/archetypes/ . On peut Ã©crire son propre archetype.</p>

<h2 id="superpom">SuperPOM</h2>

<p>Pour bien utiliser Maven, il faut respecter quelques rÃ¨gles comme lâ€™utilisation dâ€™un fichier XML nommÃ© pom.xml Ã  la racine du projet, la structure du projet, etcâ€¦</p>

<p>Ces rÃ¨gles sont definies dans le SuperPOM, il se trouve dans un fichier jar (MAVEN_HOME/lib/maven-model-builder-x.y.z/org/apache/maven/model/pom-4.0.0.xml)</p>

<h2 id="pom-projet-object-model">POM (Projet Object Model)</h2>
<p>Le pom.xml est le fichier qui dÃ©crit ce que Maven doit faire.</p>

<p>Voici le contenu crÃ©Ã© par la ligne de commande ci-dessus :</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
  <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>io.rasologg.tutoriel<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>java-maven-project<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;packaging&gt;</span>jar<span class="nt">&lt;/packaging&gt;</span>
  <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;name&gt;</span>java-maven-project<span class="nt">&lt;/name&gt;</span>
  <span class="nt">&lt;url&gt;</span>http://maven.apache.org<span class="nt">&lt;/url&gt;</span>
  <span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>3.8.1<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
  <span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</code></pre></div></div>

<p>Le fichier XML commence par le tag â€œprojectâ€ et doit respecter le schema XSD indiquÃ©.</p>

<h3 id="modelversion">modelVersion</h3>

<p>modelVersion est obligatoire et contient toujours â€œ4.0.0â€ qui correspond Ã  la version du model quâ€™on a vu dans le SuperPOM. Cette valeur existe depuis la version 2.x de Maven.</p>

<p>Avec Maven 1.x, le modelVersion est â€œ3.0.0â€.</p>

<p>La â€œ5.0.0â€ est actuellement en status â€œbrouillonâ€ (Draft) https://cwiki.apache.org/confluence/display/MAVEN/POM+Model+Version+5.0.0</p>

<h3 id="maven-coordinates">Maven coordinates</h3>

<p>Maven utilise trois tags (groupId, artifactId, version) pour identifier un projet.</p>

<p>Le <em>groupId</em> permet de grouper tous les projet par entitÃ©, souvent le nom de domaine inversÃ© de la sociÃ©tÃ© ou la personne qui a developpÃ© le projet.</p>

<p>Le tag <em>artifactId</em> câ€™est le nom du projet.</p>

<p>le tag <em>version</em> comme son nom lâ€™indique, câ€™est pour preciser la version du projet, generalement on suit le <a href="https://semver.org/">SemVer</a> x.y.z mais on peut y ajouter un â€œqualifierâ€ x.y.z-qualifier. Un qualifier specifique utile pendant le developpement est le â€œSNAPSHOTâ€, le SNAPSHOT permet dâ€™indiquer Ã  Maven que le projet est en cours de developpement.</p>

<h3 id="autres-tags">Autres tags</h3>

<p>Le packaging est le type dâ€™archivage utilisÃ© pour le projet : jar, war, rar.</p>

<p>Les autres tag : <em>name</em>, <em>url</em> sont optionnels, on peut ajouter aussi le tag <em>description</em></p>

<p>Le tag <em>dependencies</em> permet dâ€™ajouter tous les dependences utilisÃ©s par le projet, dans notre cas, on a â€œjunitâ€ ajoutÃ© par dÃ©faut pour les tests unitaires.</p>

<p>Tout au long de lâ€™evolution, on ajoutera autant de <em>â€œdependencyâ€</em> que necessaire, par exemple pour utiliser une base de donnÃ©es.</p>

<h2 id="maven-repository">Maven repository</h2>

<p>Un repository est un serveur distant oÃ¹ la communautÃ© open source partage dâ€™autres projets, et Ã  partir duquel on peut tÃ©lÃ©charger les projets quâ€™on a besoin pour construire notre application.</p>

<p>Trois types de repository : local, central et remote.</p>

<p>Local se trouve sur la machine de developpement, par dÃ©faut il se trouve dans le repertoire USER_HOME/.m2/</p>

<p>Central est le repository par dÃ©faut utilisÃ© par Maven, lâ€™adresse de ce repository se trouve dans le superPOM et qui est https://repo.maven.apache.org/maven2.</p>

<p>Remote autres repository public, accessible via Internet ou privÃ© interne Ã  lâ€™entreprise.</p>

<h2 id="comment-compiler-et-tester-le-projet">Comment compiler et tester le projet</h2>

<p>Avant de compiler, modifions un peu notre fichier â€œpom.xmlâ€ en y ajoutant quelques â€œpropertiesâ€</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
<span class="nt">&lt;url&gt;</span>http://maven.apache.org<span class="nt">&lt;/url&gt;</span>
<span class="nt">&lt;properties&gt;</span>
  <span class="nt">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.build.sourceEncoding&gt;</span>
  <span class="nt">&lt;maven.compiler.source&gt;</span>11<span class="nt">&lt;/maven.compiler.source&gt;</span>
  <span class="nt">&lt;maven.compiler.target&gt;</span>11<span class="nt">&lt;/maven.compiler.target&gt;</span>
<span class="nt">&lt;/properties&gt;</span>
<span class="nt">&lt;dependencies&gt;</span>
...
</code></pre></div></div>
<p>Ces proprietes nous permettent de configurer lâ€™encodage en â€œUTF-8â€, de specifier la version du compilateur java quâ€™on souhaite utiliser.
Et maintenant, lanÃ§ons la commande pour compiler :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn compile
</code></pre></div></div>

<pre><code class="language-log">[INFO] Scanning for projects...
[INFO]
[INFO] --------------&lt; io.rasologg.tutoriel:java-maven-project &gt;---------------
[INFO] Building java-maven-project 1.0-SNAPSHOT
[INFO] --------------------------------[ jar ]---------------------------------
[INFO]
[INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ java-maven-project ---
[INFO] Using 'UTF-8' encoding to copy filtered resources.
[INFO] skip non existing resourceDirectory /workspace/tuto/java-maven-project/src/main/resources
[INFO]
[INFO] --- maven-compiler-plugin:3.1:compile (default-compile) @ java-maven-project ---
[INFO] Changes detected - recompiling the module!
[INFO] Compiling 1 source file to /workspace/tuto/java-maven-project/target/classes
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  1.380 s
[INFO] Finished at: 2021-04-04T18:17:37+02:00
[INFO] ------------------------------------------------------------------------
</code></pre>
<p>Un nouveau repertoire â€œtargetâ€ vient dâ€™Ãªtre crÃ©Ã© pour contenir les fichiers compilÃ©s qui sont le â€œ.classâ€.</p>

<p>Pour lancer les tests unitaires :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn test
</code></pre></div></div>

<p>La commande â€œtestâ€ lance automatiquement la compilation aussi, câ€™est le cycle de vie dâ€™une commande dans Maven.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[INFO] Scanning for projects...
[INFO]
...

-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Running io.rasologg.tutoriel.AppTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.005 sec

Results :

Tests run: 1, Failures: 0, Errors: 0, Skipped: 0

[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  0.808 s
[INFO] Finished at: 2021-04-04T18:26:38+02:00
[INFO] ------------------------------------------------------------------------
</code></pre></div></div>

<p>Et maintenant pour â€œpackagerâ€ notre application, il suffit tout simplement de lancer la commande:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn package
</code></pre></div></div>
<p>Un fichier jar est crÃ©Ã© dans le repertoire â€œtargetâ€.</p>

<p>Pour supprimer le repertoire â€œtargetâ€</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn clean
</code></pre></div></div>

<p>On peut enchainer des commandes</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn clean package
</code></pre></div></div>

<p>Et si on souhaite eviter lâ€™execution des tests (chose quâ€™il faut absolument eviter mais Ã§a arrive de vouloir packager sans passer par une Ã©tape de test unitaire qui peut Ãªtre trÃ¨s long si le projet est assez compliquÃ©)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn clean package -DskipTests
</code></pre></div></div>

<h1 id="cycle-de-vie-dun-build-maven">Cycle de vie dâ€™un build maven</h1>

<p>Maven nâ€™est pas seulement pour gÃ©rer les dependances dâ€™un projet mais il gere aussi les differentes Ã©tapes de la construction dâ€™une application. Maven gere ces differentes via des plugins et en suivante une cycle de vie bien defini : validate -&gt; compile -&gt; test -&gt; package -&gt; verify -&gt; install -&gt; deploy.</p>

<p>validate : verifier la structure du projet
compile : compiler le code source
test : lancer les tests unitaires
package : crÃ©er un package contenant le code source compilÃ©
verify : lancer les tests dâ€™integration
install : copier le package dans le repository local 
deploy : transferer le package vers un repository distant.</p>

<h1 id="comment-chercher-les-dependences">Comment chercher les dependences</h1>

<p>https://search.maven.org/</p>

<p>https://mvnrepository.com/</p>

<h1 id="dependences-transitives">Dependences transitives</h1>

<p>Une dependence peut dependre dâ€™autres projets, Maven recupere automatiques ces autres projets lors de la compilation.</p>

<p>Par exemplem, si on ajoute la libraire â€œhibernate-coreâ€ dans notre projet, celle-ci emmenera dâ€™autres libraires dans notre projet.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>3.8.1<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
      <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.hibernate<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>hibernate-core<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>6.0.0.Alpha7<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
  <span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div></div>
<p>Ceci peut nous emmener des dependences quâ€™on ne souhaite pas, quâ€™on nâ€™a pas besoin dans notre projet, Maven nous propose une solution pour exclure ces dependences.</p>

<h1 id="exclure-les-dependences">Exclure les dependences</h1>

<p>Pour exclure les dependences, on peut utiliser le tag exclusions/exclusion:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>3.8.1<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
      <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.hibernate<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>hibernate-core<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>6.0.0.Alpha7<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;exclusions&gt;</span>
        <span class="nt">&lt;exclusion&gt;</span>
          <span class="nt">&lt;groupId&gt;</span>org.jboss.logging<span class="nt">&lt;/groupId&gt;</span>
          <span class="nt">&lt;artifactId&gt;</span>jboss-logging<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/exclusion&gt;</span>
      <span class="nt">&lt;/exclusions&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
  <span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div></div>

<h1 id="dependency-mediation">Dependency mediation</h1>

<p>Sâ€™il y a un conflit sur la version dâ€™une dependance, Maven utilise la plus proche du graphe de dependances (nearest definition).</p>

<p>Par exemple, le projet A depend des deux projets B et C la version 2.0, et B depend aussi du projet C mais la version 1.1, Maven choisira la version 2.0 du projet C.</p>

<h1 id="dependance-cyclique">Dependance cyclique</h1>

<p>Un projet A depend du projet B et B depend de A, est une dependance cyclique. Maven ne peut pas gerer ce genre de dependance.</p>

<h1 id="scope">Scope</h1>

<p>Un autre moyen de filtrer les dependences, on peut utiliser le â€œscopeâ€, par exemple des dependences qui ne sont utiles que pour les tests unitaires seulement, on peut ajouter le scope â€œtestâ€.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>3.8.1<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<p>La valeur par dÃ©faut dâ€™un scope est â€œcompileâ€, dâ€™autres valeurs sont possible : runtime, provided</p>

<h1 id="version">Version</h1>

<p>La methode la plus simple et la plus sur est de specifier une valeur fixe de la version de dependence, mais Maven nous permet dâ€™ajouter un peu plus de flexibilitÃ©</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;version&gt;</span>[4.1,]<span class="nt">&lt;/version&gt;</span> <span class="c">&lt;!-- la version la plus recente aprÃ¨s 4.1--&gt;</span>
<span class="nt">&lt;version&gt;</span>[4.1,4.5]<span class="nt">&lt;/version&gt;</span> <span class="c">&lt;!-- la version la plus recente entre 4.1 et 4.5 --&gt;</span>
<span class="nt">&lt;version&gt;</span>[4.1,4.5)<span class="nt">&lt;/version&gt;</span> <span class="c">&lt;!-- la version entre 4.1 et avant la 4.5, 4.5 exclue --&gt;</span>
<span class="nt">&lt;version&gt;</span>[,4.5]<span class="nt">&lt;/version&gt;</span> <span class="c">&lt;!-- le maximum 4.5 --&gt;</span>
</code></pre></div></div>

<h1 id="effective-pom">Effective POM</h1>

<p>Plus haut on a parlÃ© dâ€™un Super POM, la configuration par dÃ©faut de Maven. Ce super POM est ajoutÃ© automatiquement par Maven au projet, qui nous donne lâ€™effective POM.</p>

<p>A noter que le contenu du super pom peut Ãªtre surcharger par le pom du projet.</p>

<p>On peut regarder lâ€™effective pom via la ligne de commande suivante :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn help:effective-pom -output=effective-pom.xml
</code></pre></div></div>

<h1 id="comment-fonctionne-maven-architecture-">Comment fonctionne Maven (architecture) ?</h1>

<p><img src="/assets/images/maven-architecture.png" alt="Architecture de Maven" /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn help:effective-settings -Doutput=effective-settings.xml
</code></pre></div></div>

<h1 id="plugins">Plugins</h1>
<p>Les plugins apportent beaucoup dâ€™outil utile pour le projet, par exemple pour compiler, pour executer les tests.
Par dÃ©faut Maven ajoute beaucoup de plugins venant du superPOM, et certaines configurations ne nous conviennent pas, et pour resoudre ce probleme il suffit de surcharger la configuration.</p>

<p>Par exemple, pour changer la version de Java, on surcharge la configuration du plugin maven-compiler-plugin</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;build&gt;</span>
  <span class="nt">&lt;plugins&gt;</span>
    <span class="nt">&lt;plugin&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;configuration&gt;</span>
        <span class="nt">&lt;source&gt;</span>11<span class="nt">&lt;/source&gt;</span>
        <span class="nt">&lt;target&gt;</span>11<span class="nt">&lt;/target&gt;</span>
      <span class="nt">&lt;/configuration&gt;</span>
    <span class="nt">&lt;/plugin&gt;</span>
  <span class="nt">&lt;/plugins&gt;</span>
<span class="nt">&lt;/build&gt;</span>
</code></pre></div></div>

<h1 id="multi-modules">Multi-modules</h1>
<p>Techniquement on peut avoir un projet Java composÃ© dâ€™un seul module (un seul pom.xml), mais au fur et Ã  mesure de lâ€™evolution du projet, une restructuration est necessaire, par exemple les codes qui gere lâ€™accÃ¨s aux donnÃ©es dans un repertoire et les codes qui gerent la logique metier dans un autre repertoire.
Câ€™est pour gÃ©rer ce genre de problematique que Maven propose le multi-module.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>projet-parent
â”œâ”€â”€ pom.xml
    â”œâ”€â”€ module1
         â”œâ”€â”€ pom.xml
    â”œâ”€â”€ module2
         â”œâ”€â”€ pom.xml
</code></pre></div></div>

<h1 id="packaging-avec-jib">Packaging avec Jib</h1>

<p>Le packaging est le type dâ€™archivage utilisÃ© pour le projet : jar, war, rar. Avant lâ€™utilisation du Cloud et la conteneurisation, on utilise le war ou la jar pour deployer lâ€™application.</p>

<p>Avec lâ€™architecture Cloud Native, le packaging final est maintenant une image conteneur (image docker). Cette image peut Ãªtre construite de differente faÃ§on, via un fichier Dockerfile, mais dans le cadre de Maven, on sâ€™interesse au plugi <a href="https://github.com/GoogleContainerTools/jib">Jib</a>.</p>

<p>Jib est un plugin Maven developpÃ© par Google qui permet de crÃ©er une image conteneur en mode 100% Java. Via un Dockerfile, on est obligÃ© dâ€™installer lâ€™application Docker parce quâ€™on a besoin du demon docker.</p>

<h1 id="astuces">Astuces</h1>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn help:describe -Ddetail=true -Dplugin=compiler
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn help:help -Ddetail=true
</code></pre></div></div>
:ET