<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.2.0">Jekyll</generator><link href="https://rasologg.github.io/feed.xml" rel="self" type="application/atom+xml" /><link href="https://rasologg.github.io/" rel="alternate" type="text/html" /><updated>2021-05-02T17:53:30+02:00</updated><id>https://rasologg.github.io/feed.xml</id><title type="html">GÃ©gÃ© Rasolondraibe</title><subtitle>Un blog trÃ¨s simple pour partager ma passion.</subtitle><entry><title type="html">Quarkus: dÃ©velopper un microservice cloud-native</title><link href="https://rasologg.github.io/developper-avec-quarkus/" rel="alternate" type="text/html" title="Quarkus: dÃ©velopper un microservice cloud-native" /><published>2021-04-30T13:33:29+02:00</published><updated>2021-04-30T13:33:29+02:00</updated><id>https://rasologg.github.io/developper-avec-quarkus</id><content type="html" xml:base="https://rasologg.github.io/developper-avec-quarkus/">&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;
&lt;p&gt;Depuis lâ€™avÃ¨nement de Docker, Kubernetes, Cloud, beaucoup de frameworks ont vu le jour.
Pour rappel, la philosophie de Java est : Ã©crire le code une fois et lancer sur nâ€™importe quel systÃ¨me dâ€™exploitation (le fameux WORA : Write Once Run Anywhere).
Ce choix nâ€™a que des avantages, on constate aussi des problÃ¨mes comme le temps de dÃ©marrage de lâ€™application, la consommation des resources memoire (RAM).&lt;/p&gt;

&lt;p&gt;Ce WORA a du sens Ã  lâ€™Ã©poque on deployait lâ€™application sur un systÃ¨me precis Linux, Windows, MacOS, mais maintenant on crÃ©e une image et on lance lâ€™application avec une plateforme dâ€™execution dâ€™un conteneur comme Docker par exemple.
En production on orchestre avec Kubernetes ou dâ€™autres plateforme equivalentes.&lt;/p&gt;

&lt;p&gt;Alors pourquoi ne pas construire lâ€™application comme un vrai natif â€œCloudâ€ ? Pour rÃ©pondre Ã  cette question que des frameworks comme Quarkus ont vu le jour.&lt;/p&gt;

&lt;p&gt;Quarkus, est un framework developpÃ© par RedHat, open source et apporte des avantages comme :&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;taille du package rÃ©duite&lt;/li&gt;
  &lt;li&gt;utilisation de memoire RAM fortement rÃ©duite&lt;/li&gt;
  &lt;li&gt;temps de dÃ©marrage accÃ©lÃ©rÃ© pour gÃ©rer la montÃ©e en charge facilement dans un systÃ¨me cloud (Kubernetes) (scale up)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Ceci grace Ã  la compilation AOT (Ahead-Of-Time), en une phrase, compile lâ€™application directement en binaire proche du CPU, contrairement Ã  lâ€™ancien mode JIT (Just-In-Time) qui interprete le bytecode au moment oÃ¹ on appelle.&lt;/p&gt;

&lt;p&gt;En tant que dÃ©veloppeur, Quarkus apporte aussi des avantages comme :&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;lâ€™auto-chargement des modifications, pas besoin dâ€™arrÃªter et rÃ©dÃ©mmarrer lâ€™application Ã  chaque fois quâ€™on modifie le code&lt;/li&gt;
  &lt;li&gt;on se focalise Ã  lâ€™Ã©crire des tests fonctionnels&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;crÃ©er-un-projet&quot;&gt;CrÃ©er un projet&lt;/h1&gt;

&lt;p&gt;Plusieurs faÃ§ons de crÃ©er un projet Quarkus :&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;via le portail https://code.quarkus.io/ Ã  la Spring Initializr.&lt;/li&gt;
  &lt;li&gt;via votre IDE prÃ©fÃ©rÃ© comme Intellij, ou Microsoft VS Code&lt;/li&gt;
  &lt;li&gt;via Maven&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Avec Maven :&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mvn io.quarkus:quarkus-maven-plugin:1.13.3.Final:create -DprojectGroupId=io.rasologg.survey 
-DprojectArtifactId=survey -DprojectVersion=1.0.0-SNAPSHOT 
-DclassName=io.rasologg.survey.web.SurveyResource -Dpath=/surveys
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Cette commande devrait afficher le message ci-dessous et crÃ©e un projet nommÃ© â€œsurveyâ€.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-----------
...
applying codestarts...
ğŸ”  java
ğŸ§° maven
ğŸ—ƒ quarkus
ğŸ“œ config-properties
ğŸ›  dockerfiles
ğŸ›  maven-wrapper
ğŸ’ resteasy-example

-----------

[SUCCESS] âœ… quarkus project has been successfully generated in:
--&amp;gt; /Users/g.rasolondraibe/workspace/tuto/survey
-----------
[INFO]
[INFO] ========================================================================================
[INFO] Your new application has been created in /Users/g.rasolondraibe/workspace/tuto/survey
[INFO] Navigate into this directory and launch your application with mvn quarkus:dev
[INFO] Your application will be accessible on http://localhost:8080
[INFO] ========================================================================================
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  6.064 s
[INFO] Finished at: 2021-05-01T10:00:05+02:00
[INFO] ------------------------------------------------------------------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Voici la structure du projet crÃ©Ã© par le plugin Maven de quarkus&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;survey
â”œâ”€â”€ README.md
â”œâ”€â”€ mvnw
â”œâ”€â”€ mvnw.cmd
â”œâ”€â”€ pom.xml
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚Â Â  â”œâ”€â”€ docker
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ Dockerfile.jvm
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ Dockerfile.legacy-jar
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ Dockerfile.native
    â”‚Â Â  â”‚Â Â  â””â”€â”€ Dockerfile.native-distroless
    â”‚Â Â  â”œâ”€â”€ java
    â”‚Â Â  â”‚Â Â  â””â”€â”€ io
    â”‚Â Â  â”‚Â Â      â””â”€â”€ rasologg
    â”‚Â Â  â”‚Â Â          â””â”€â”€ survey
    â”‚Â Â  â”‚Â Â              â””â”€â”€ web
    â”‚Â Â  â”‚Â Â                  â””â”€â”€ SurveyResource.java
    â”‚Â Â  â””â”€â”€ resources
    â”‚Â Â      â”œâ”€â”€ META-INF
    â”‚Â Â      â”‚Â Â  â””â”€â”€ resources
    â”‚Â Â      â”‚Â Â      â””â”€â”€ index.html
    â”‚Â Â      â””â”€â”€ application.properties
    â””â”€â”€ test
        â””â”€â”€ java
            â””â”€â”€ io
                â””â”€â”€ rasologg
                    â””â”€â”€ survey
                        â””â”€â”€ web
                            â”œâ”€â”€ NativeSurveyResourceIT.java
                            â””â”€â”€ SurveyResourceTest.java
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Pour lancer le projet quâ€™on vient de crÃ©er&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;â¯ cd survey
â¯ ./mvnw quarkus:dev
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[INFO] Scanning for projects...
[INFO]
[INFO] ---------------------&amp;lt; io.rasologg.survey:survey &amp;gt;----------------------
[INFO] Building survey 1.0.0-SNAPSHOT
[INFO] --------------------------------[ jar ]---------------------------------
[INFO]
[INFO] --- quarkus-maven-plugin:1.13.3.Final:dev (default-cli) @ survey ---
[INFO] Using 'UTF-8' encoding to copy filtered resources.
[INFO] Copying 2 resources
[INFO] Nothing to compile - all classes are up to date
Listening for transport dt_socket at address: 5005
__  ____  __  _____   ___  __ ____  ______
 --/ __ \/ / / / _ | / _ \/ //_/ / / / __/
 -/ /_/ / /_/ / __ |/ , _/ ,&amp;lt; / /_/ /\ \
--\___\_\____/_/ |_/_/|_/_/|_|\____/___/
2021-05-01 10:11:47,612 INFO  [io.quarkus] (Quarkus Main Thread) survey 1.0.0-SNAPSHOT on JVM (powered by Quarkus 1.13.3.Final) started in 1.861s. Listening on: http://localhost:8080
2021-05-01 10:11:47,652 INFO  [io.quarkus] (Quarkus Main Thread) Profile dev activated. Live Coding activated.
2021-05-01 10:11:47,652 INFO  [io.quarkus] (Quarkus Main Thread) Installed features: [cdi, resteasy]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/quarkus-welcome-page.png&quot; alt=&quot;Quarkus page de bienvenu&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Ouvrons le projet avec un IDE et analysons son contenu.&lt;/p&gt;

&lt;p&gt;Comme vous lâ€™avez remarquÃ©, il nâ€™y a que SurveyResource.java qui a Ã©tÃ© crÃ©Ã©, pas de class main.
Quarkus ne crÃ©e pas une class â€œmainâ€ dans le projet, pas comme les autres frameworks comme Spring. 
Le projet utilise la class par dÃ©faut de Quarkus : io.quarkus.runner.GeneratedMain.
Mais ceci nâ€™empeche pas de crÃ©er une class main personalisÃ©e si on le souhaite.&lt;/p&gt;

&lt;p&gt;Par exemple :&lt;/p&gt;
&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;io.quarkus.runtime.Quarkus&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;io.quarkus.runtime.annotations.QuarkusMain&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;nd&quot;&gt;@QuarkusMain&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;SurveyMain&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nc&quot;&gt;Quarkus&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Quarkus crÃ©e un repertoire â€œdockerâ€ contenant des Dockerfiles quâ€™on utilisera pour crÃ©er lâ€™image du conteneur. 
Il est aussi possible dâ€™utiliser Jib pour crÃ©er lâ€™image du conteneur sans passer par un Dockerfile.&lt;/p&gt;

&lt;p&gt;//TODO â€¦&lt;/p&gt;</content><author><name></name></author><category term="blog" /><summary type="html">Introduction Depuis lâ€™avÃ¨nement de Docker, Kubernetes, Cloud, beaucoup de frameworks ont vu le jour. Pour rappel, la philosophie de Java est : Ã©crire le code une fois et lancer sur nâ€™importe quel systÃ¨me dâ€™exploitation (le fameux WORA : Write Once Run Anywhere). Ce choix nâ€™a que des avantages, on constate aussi des problÃ¨mes comme le temps de dÃ©marrage de lâ€™application, la consommation des resources memoire (RAM).</summary></entry><entry><title type="html">Java : developper avec Maven</title><link href="https://rasologg.github.io/apache-maven/" rel="alternate" type="text/html" title="Java : developper avec Maven" /><published>2021-04-16T13:33:29+02:00</published><updated>2021-04-16T13:33:29+02:00</updated><id>https://rasologg.github.io/apache-maven</id><content type="html" xml:base="https://rasologg.github.io/apache-maven/">&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;

&lt;p&gt;Maven (plus precisement Apache Maven) est un outil de gestion de dÃ©pendances en Java. Mais il permet aussi dâ€™automatiser differentes Ã©tapes utiles pendant un developpement logiciel : tests et qualitÃ©, compilation, packaging, archivage et documentation.&lt;/p&gt;

&lt;p&gt;De maniÃ¨re generale, une application Ã©crite en Java, par exemple un microservice, a besoin dâ€™utiliser une base de donnÃ©es, de lancer un serveur web HTTP ou dâ€™effectuer des calculs, etcâ€¦.&lt;/p&gt;

&lt;p&gt;Pas besoin de rÃ©inventer la roue, quelquâ€™un a dÃ©jÃ  fait le travail Ã  notre place et a publiÃ© ses projets sur Internet, câ€™est la magie de lâ€™Open Source.&lt;/p&gt;

&lt;p&gt;Pour rÃ©utiliser ces composants Open Source dans notre projet, on a besoin dâ€™un outil comme Maven. Il nous aide Ã  rÃ©soudre beaucoup de problÃ©matiques comme la compatibilitÃ© des versions, lâ€™inter-dependance entre composants, etcâ€¦&lt;/p&gt;

&lt;p&gt;Dans le monde Java, il y a trois principaux outils pour gÃ©rer les dependances :&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://maven.apache.org&quot;&gt;Apache Maven&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://gradle.org/&quot;&gt;Gradle&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://ant.apache.org/&quot;&gt;Apache Ant&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Apache Maven reste le plus populaire et le plus utilisÃ© mÃªme si Gradle monte en puissance.&lt;/p&gt;

&lt;p&gt;Apache Maven a commencÃ© en 2002, trÃ¨s stable, robuste et supportÃ© par la majoritÃ© des IDEs (Intellij, Eclipse, â€¦), il est aussi utilisÃ© par quasiment tous les projets Open Source.&lt;/p&gt;

&lt;h1 id=&quot;installation&quot;&gt;Installation&lt;/h1&gt;

&lt;p&gt;En tant que DÃ©veloppeur, on utilise trÃ¨s souvent plusieurs outils et en plusieurs versions. Pour faciliter lâ€™installation et la gestion de ces outils, on peut utiliser &lt;a href=&quot;https://sdkman.io/&quot;&gt;SDK Man&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;La procedure Ã  suivre pour installer SDKMan est disponible Ã  lâ€™adresse suivante https://sdkman.io/install.&lt;/p&gt;

&lt;p&gt;Une fois SDKMan est installÃ©, lancÃ© la commande suivante pour installer Java JDK (sâ€™il nâ€™est pas dÃ©jÃ  installÃ© sur votre ordinateur) :&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sdk install java 11.0.10.hs-adpt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;La 11.0.10.hs-adpt est la derniere version de OpenJDK11 disponible sur la plateforme sdkman au moment oÃ¹ jâ€™Ã©cris cet article mais vous pouvez afficher la derniÃ¨re version via la commande :&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sdk ls java
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;AprÃ¨s avoir installÃ© Java, voici la commande pour installer Maven :&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sdk install maven
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A noter que Maven est integrÃ© par dÃ©faut dans lâ€™IDE comme Intellij, Eclipse. On peut lâ€™utiliser directement mais personnelement je prefere utiliser la ligne de commande et avoir une installation Ã  lâ€™exterieur de lâ€™IDE.&lt;/p&gt;

&lt;p&gt;Pour vÃ©rifier que lâ€™installation a bien fonctionnÃ© :&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mvn --version
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Le rÃ©sultat devrait afficher la version de Maven et son emplacement.&lt;/p&gt;

&lt;h1 id=&quot;crÃ©er-un-projet-java-via-maven&quot;&gt;CrÃ©er un projet Java via Maven&lt;/h1&gt;

&lt;p&gt;On peut crÃ©er un projet Java/Maven via un IDE type Intellij ou Eclipse, mais pour comprendre le fonctionnement, on va dâ€™abord crÃ©er un projet Maven via la ligne commande :&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mvn archetype:generate -DgroupId=io.rasologg.tutoriel -DartifactId=java-maven-project -DarchetypeArtifactId=maven-archetype-quickstart -DinteractiveMode=false
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Si tout va bien, des fichiers seront tÃ©lÃ©chargÃ©s et Maven va crÃ©er un le projet contenant structurÃ© comme ci-dessous :&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;java-maven-project
â”œâ”€â”€ pom.xml
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚Â Â  â””â”€â”€ java
    â”‚Â Â      â””â”€â”€ io
    â”‚Â Â          â””â”€â”€ rasologg
    â”‚Â Â              â””â”€â”€ tutoriel
    â”‚Â Â                  â””â”€â”€ App.java
    â””â”€â”€ test
        â””â”€â”€ java
            â””â”€â”€ io
                â””â”€â”€ rasologg
                    â””â”€â”€ tutoriel
                        â””â”€â”€ AppTest.java
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h2 id=&quot;archetype&quot;&gt;Archetype&lt;/h2&gt;

&lt;p&gt;Simplement un template de projet, ici on utilise â€œmaven-archetype-quickstartâ€ est genere un projet Java trÃ¨s basique Ã  partir du template. On peut trouver une liste des archetypes inclus par dÃ©faut dans Maven https://maven.apache.org/archetypes/ . On peut Ã©crire son propre archetype.&lt;/p&gt;

&lt;h2 id=&quot;superpom&quot;&gt;SuperPOM&lt;/h2&gt;

&lt;p&gt;Pour bien utiliser Maven, il faut respecter quelques rÃ¨gles comme lâ€™utilisation dâ€™un fichier XML nommÃ© pom.xml Ã  la racine du projet, la structure du projet, etcâ€¦&lt;/p&gt;

&lt;p&gt;Ces rÃ¨gles sont definies dans le SuperPOM, il se trouve dans un fichier jar (MAVEN_HOME/lib/maven-model-builder-x.y.z/org/apache/maven/model/pom-4.0.0.xml)&lt;/p&gt;

&lt;h2 id=&quot;pom-projet-object-model&quot;&gt;POM (Projet Object Model)&lt;/h2&gt;
&lt;p&gt;Le pom.xml est le fichier qui dÃ©crit ce que Maven doit faire.&lt;/p&gt;

&lt;p&gt;Voici le contenu crÃ©Ã© par la ligne de commande ci-dessus :&lt;/p&gt;

&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;project&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://maven.apache.org/POM/4.0.0&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:xsi=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;xsi:schemaLocation=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;modelVersion&amp;gt;&lt;/span&gt;4.0.0&lt;span class=&quot;nt&quot;&gt;&amp;lt;/modelVersion&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;io.rasologg.tutoriel&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;java-maven-project&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;packaging&amp;gt;&lt;/span&gt;jar&lt;span class=&quot;nt&quot;&gt;&amp;lt;/packaging&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;1.0-SNAPSHOT&lt;span class=&quot;nt&quot;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;name&amp;gt;&lt;/span&gt;java-maven-project&lt;span class=&quot;nt&quot;&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;url&amp;gt;&lt;/span&gt;http://maven.apache.org&lt;span class=&quot;nt&quot;&gt;&amp;lt;/url&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;dependencies&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;junit&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;junit&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;3.8.1&lt;span class=&quot;nt&quot;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependencies&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/project&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Le fichier XML commence par le tag â€œprojectâ€ et doit respecter le schema XSD indiquÃ©.&lt;/p&gt;

&lt;h3 id=&quot;modelversion&quot;&gt;modelVersion&lt;/h3&gt;

&lt;p&gt;modelVersion est obligatoire et contient toujours â€œ4.0.0â€ qui correspond Ã  la version du model quâ€™on a vu dans le SuperPOM. Cette valeur existe depuis la version 2.x de Maven.&lt;/p&gt;

&lt;p&gt;Avec Maven 1.x, le modelVersion est â€œ3.0.0â€.&lt;/p&gt;

&lt;p&gt;La â€œ5.0.0â€ est actuellement en status â€œbrouillonâ€ (Draft) https://cwiki.apache.org/confluence/display/MAVEN/POM+Model+Version+5.0.0&lt;/p&gt;

&lt;h3 id=&quot;maven-coordinates&quot;&gt;Maven coordinates&lt;/h3&gt;

&lt;p&gt;Maven utilise trois tags (groupId, artifactId, version) pour identifier un projet.&lt;/p&gt;

&lt;p&gt;Le &lt;em&gt;groupId&lt;/em&gt; permet de grouper tous les projet par entitÃ©, souvent le nom de domaine inversÃ© de la sociÃ©tÃ© ou la personne qui a developpÃ© le projet.&lt;/p&gt;

&lt;p&gt;Le tag &lt;em&gt;artifactId&lt;/em&gt; câ€™est le nom du projet.&lt;/p&gt;

&lt;p&gt;le tag &lt;em&gt;version&lt;/em&gt; comme son nom lâ€™indique, câ€™est pour preciser la version du projet, generalement on suit le &lt;a href=&quot;https://semver.org/&quot;&gt;SemVer&lt;/a&gt; x.y.z mais on peut y ajouter un â€œqualifierâ€ x.y.z-qualifier. Un qualifier specifique utile pendant le developpement est le â€œSNAPSHOTâ€, le SNAPSHOT permet dâ€™indiquer Ã  Maven que le projet est en cours de developpement.&lt;/p&gt;

&lt;h3 id=&quot;autres-tags&quot;&gt;Autres tags&lt;/h3&gt;

&lt;p&gt;Le packaging est le type dâ€™archivage utilisÃ© pour le projet : jar, war, rar.&lt;/p&gt;

&lt;p&gt;Les autres tag : &lt;em&gt;name&lt;/em&gt;, &lt;em&gt;url&lt;/em&gt; sont optionnels, on peut ajouter aussi le tag &lt;em&gt;description&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Le tag &lt;em&gt;dependencies&lt;/em&gt; permet dâ€™ajouter tous les dependences utilisÃ©s par le projet, dans notre cas, on a â€œjunitâ€ ajoutÃ© par dÃ©faut pour les tests unitaires.&lt;/p&gt;

&lt;p&gt;Tout au long de lâ€™evolution, on ajoutera autant de &lt;em&gt;â€œdependencyâ€&lt;/em&gt; que necessaire, par exemple pour utiliser une base de donnÃ©es.&lt;/p&gt;

&lt;h2 id=&quot;maven-repository&quot;&gt;Maven repository&lt;/h2&gt;

&lt;p&gt;Un repository est un serveur distant oÃ¹ la communautÃ© open source partage dâ€™autres projets, et Ã  partir duquel on peut tÃ©lÃ©charger les projets quâ€™on a besoin pour construire notre application.&lt;/p&gt;

&lt;p&gt;Trois types de repository : local, central et remote.&lt;/p&gt;

&lt;p&gt;Local se trouve sur la machine de developpement, par dÃ©faut il se trouve dans le repertoire USER_HOME/.m2/&lt;/p&gt;

&lt;p&gt;Central est le repository par dÃ©faut utilisÃ© par Maven, lâ€™adresse de ce repository se trouve dans le superPOM et qui est https://repo.maven.apache.org/maven2.&lt;/p&gt;

&lt;p&gt;Remote autres repository public, accessible via Internet ou privÃ© interne Ã  lâ€™entreprise.&lt;/p&gt;

&lt;h2 id=&quot;comment-compiler-et-tester-le-projet&quot;&gt;Comment compiler et tester le projet&lt;/h2&gt;

&lt;p&gt;Avant de compiler, modifions un peu notre fichier â€œpom.xmlâ€ en y ajoutant quelques â€œpropertiesâ€&lt;/p&gt;

&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;...
&lt;span class=&quot;nt&quot;&gt;&amp;lt;url&amp;gt;&lt;/span&gt;http://maven.apache.org&lt;span class=&quot;nt&quot;&gt;&amp;lt;/url&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;properties&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;project.build.sourceEncoding&amp;gt;&lt;/span&gt;UTF-8&lt;span class=&quot;nt&quot;&gt;&amp;lt;/project.build.sourceEncoding&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;maven.compiler.source&amp;gt;&lt;/span&gt;11&lt;span class=&quot;nt&quot;&gt;&amp;lt;/maven.compiler.source&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;maven.compiler.target&amp;gt;&lt;/span&gt;11&lt;span class=&quot;nt&quot;&gt;&amp;lt;/maven.compiler.target&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/properties&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;dependencies&amp;gt;&lt;/span&gt;
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Ces proprietes nous permettent de configurer lâ€™encodage en â€œUTF-8â€, de specifier la version du compilateur java quâ€™on souhaite utiliser.
Et maintenant, lanÃ§ons la commande pour compiler :&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mvn compile
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;pre&gt;&lt;code class=&quot;language-log&quot;&gt;[INFO] Scanning for projects...
[INFO]
[INFO] --------------&amp;lt; io.rasologg.tutoriel:java-maven-project &amp;gt;---------------
[INFO] Building java-maven-project 1.0-SNAPSHOT
[INFO] --------------------------------[ jar ]---------------------------------
[INFO]
[INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ java-maven-project ---
[INFO] Using 'UTF-8' encoding to copy filtered resources.
[INFO] skip non existing resourceDirectory /workspace/tuto/java-maven-project/src/main/resources
[INFO]
[INFO] --- maven-compiler-plugin:3.1:compile (default-compile) @ java-maven-project ---
[INFO] Changes detected - recompiling the module!
[INFO] Compiling 1 source file to /workspace/tuto/java-maven-project/target/classes
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  1.380 s
[INFO] Finished at: 2021-04-04T18:17:37+02:00
[INFO] ------------------------------------------------------------------------
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Un nouveau repertoire â€œtargetâ€ vient dâ€™Ãªtre crÃ©Ã© pour contenir les fichiers compilÃ©s qui sont le â€œ.classâ€.&lt;/p&gt;

&lt;p&gt;Pour lancer les tests unitaires :&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mvn test
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;La commande â€œtestâ€ lance automatiquement la compilation aussi, câ€™est le cycle de vie dâ€™une commande dans Maven.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[INFO] Scanning for projects...
[INFO]
...

-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Running io.rasologg.tutoriel.AppTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.005 sec

Results :

Tests run: 1, Failures: 0, Errors: 0, Skipped: 0

[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  0.808 s
[INFO] Finished at: 2021-04-04T18:26:38+02:00
[INFO] ------------------------------------------------------------------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Et maintenant pour â€œpackagerâ€ notre application, il suffit tout simplement de lancer la commande:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mvn package
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Un fichier jar est crÃ©Ã© dans le repertoire â€œtargetâ€.&lt;/p&gt;

&lt;p&gt;Pour supprimer le repertoire â€œtargetâ€&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mvn clean
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;On peut enchainer des commandes&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mvn clean package
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Et si on souhaite eviter lâ€™execution des tests (chose quâ€™il faut absolument eviter mais Ã§a arrive de vouloir packager sans passer par une Ã©tape de test unitaire qui peut Ãªtre trÃ¨s long si le projet est assez compliquÃ©)&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mvn clean package -DskipTests
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;cycle-de-vie-dun-build-maven&quot;&gt;Cycle de vie dâ€™un build maven&lt;/h1&gt;

&lt;p&gt;Maven nâ€™est pas seulement pour gÃ©rer les dependances dâ€™un projet mais il gere aussi les differentes Ã©tapes de la construction dâ€™une application. Maven gere ces differentes via des plugins et en suivante une cycle de vie bien defini : validate -&amp;gt; compile -&amp;gt; test -&amp;gt; package -&amp;gt; verify -&amp;gt; install -&amp;gt; deploy.&lt;/p&gt;

&lt;p&gt;validate : verifier la structure du projet
compile : compiler le code source
test : lancer les tests unitaires
package : crÃ©er un package contenant le code source compilÃ©
verify : lancer les tests dâ€™integration
install : copier le package dans le repository local 
deploy : transferer le package vers un repository distant.&lt;/p&gt;

&lt;h1 id=&quot;comment-chercher-les-dependences&quot;&gt;Comment chercher les dependences&lt;/h1&gt;

&lt;p&gt;https://search.maven.org/&lt;/p&gt;

&lt;p&gt;https://mvnrepository.com/&lt;/p&gt;

&lt;h1 id=&quot;dependences-transitives&quot;&gt;Dependences transitives&lt;/h1&gt;

&lt;p&gt;Une dependence peut dependre dâ€™autres projets, Maven recupere automatiques ces autres projets lors de la compilation.&lt;/p&gt;

&lt;p&gt;Par exemplem, si on ajoute la libraire â€œhibernate-coreâ€ dans notre projet, celle-ci emmenera dâ€™autres libraires dans notre projet.&lt;/p&gt;

&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  &lt;span class=&quot;nt&quot;&gt;&amp;lt;dependencies&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;junit&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;junit&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;3.8.1&lt;span class=&quot;nt&quot;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.hibernate&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;hibernate-core&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;6.0.0.Alpha7&lt;span class=&quot;nt&quot;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependencies&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Ceci peut nous emmener des dependences quâ€™on ne souhaite pas, quâ€™on nâ€™a pas besoin dans notre projet, Maven nous propose une solution pour exclure ces dependences.&lt;/p&gt;

&lt;h1 id=&quot;exclure-les-dependences&quot;&gt;Exclure les dependences&lt;/h1&gt;

&lt;p&gt;Pour exclure les dependences, on peut utiliser le tag exclusions/exclusion:&lt;/p&gt;

&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  &lt;span class=&quot;nt&quot;&gt;&amp;lt;dependencies&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;junit&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;junit&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;3.8.1&lt;span class=&quot;nt&quot;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;scope&amp;gt;&lt;/span&gt;test&lt;span class=&quot;nt&quot;&gt;&amp;lt;/scope&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.hibernate&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;hibernate-core&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;6.0.0.Alpha7&lt;span class=&quot;nt&quot;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;exclusions&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;exclusion&amp;gt;&lt;/span&gt;
          &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.jboss.logging&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
          &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;jboss-logging&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;/exclusion&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;/exclusions&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependencies&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;dependency-mediation&quot;&gt;Dependency mediation&lt;/h1&gt;

&lt;p&gt;Sâ€™il y a un conflit sur la version dâ€™une dependance, Maven utilise la plus proche du graphe de dependances (nearest definition).&lt;/p&gt;

&lt;p&gt;Par exemple, le projet A depend des deux projets B et C la version 2.0, et B depend aussi du projet C mais la version 1.1, Maven choisira la version 2.0 du projet C.&lt;/p&gt;

&lt;h1 id=&quot;dependance-cyclique&quot;&gt;Dependance cyclique&lt;/h1&gt;

&lt;p&gt;Un projet A depend du projet B et B depend de A, est une dependance cyclique. Maven ne peut pas gerer ce genre de dependance.&lt;/p&gt;

&lt;h1 id=&quot;scope&quot;&gt;Scope&lt;/h1&gt;

&lt;p&gt;Un autre moyen de filtrer les dependences, on peut utiliser le â€œscopeâ€, par exemple des dependences qui ne sont utiles que pour les tests unitaires seulement, on peut ajouter le scope â€œtestâ€.&lt;/p&gt;

&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;junit&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;junit&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;3.8.1&lt;span class=&quot;nt&quot;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;scope&amp;gt;&lt;/span&gt;test&lt;span class=&quot;nt&quot;&gt;&amp;lt;/scope&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;La valeur par dÃ©faut dâ€™un scope est â€œcompileâ€, dâ€™autres valeurs sont possible : runtime, provided&lt;/p&gt;

&lt;h1 id=&quot;version&quot;&gt;Version&lt;/h1&gt;

&lt;p&gt;La methode la plus simple et la plus sur est de specifier une valeur fixe de la version de dependence, mais Maven nous permet dâ€™ajouter un peu plus de flexibilitÃ©&lt;/p&gt;
&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;[4.1,]&lt;span class=&quot;nt&quot;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- la version la plus recente aprÃ¨s 4.1--&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;[4.1,4.5]&lt;span class=&quot;nt&quot;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- la version la plus recente entre 4.1 et 4.5 --&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;[4.1,4.5)&lt;span class=&quot;nt&quot;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- la version entre 4.1 et avant la 4.5, 4.5 exclue --&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;[,4.5]&lt;span class=&quot;nt&quot;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- le maximum 4.5 --&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;effective-pom&quot;&gt;Effective POM&lt;/h1&gt;

&lt;p&gt;Plus haut on a parlÃ© dâ€™un Super POM, la configuration par dÃ©faut de Maven. Ce super POM est ajoutÃ© automatiquement par Maven au projet, qui nous donne lâ€™effective POM.&lt;/p&gt;

&lt;p&gt;A noter que le contenu du super pom peut Ãªtre surcharger par le pom du projet.&lt;/p&gt;

&lt;p&gt;On peut regarder lâ€™effective pom via la ligne de commande suivante :&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mvn help:effective-pom -output=effective-pom.xml
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;comment-fonctionne-maven-architecture-&quot;&gt;Comment fonctionne Maven (architecture) ?&lt;/h1&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/maven-architecture.png&quot; alt=&quot;Architecture de Maven&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mvn help:effective-settings -Doutput=effective-settings.xml
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;plugins&quot;&gt;Plugins&lt;/h1&gt;
&lt;p&gt;Les plugins apportent beaucoup dâ€™outil utile pour le projet, par exemple pour compiler, pour executer les tests.
Par dÃ©faut Maven ajoute beaucoup de plugins venant du superPOM, et certaines configurations ne nous conviennent pas, et pour resoudre ce probleme il suffit de surcharger la configuration.&lt;/p&gt;

&lt;p&gt;Par exemple, pour changer la version de Java, on surcharge la configuration du plugin maven-compiler-plugin&lt;/p&gt;

&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;build&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;plugins&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;plugin&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;maven-compiler-plugin&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;configuration&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;source&amp;gt;&lt;/span&gt;11&lt;span class=&quot;nt&quot;&gt;&amp;lt;/source&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;target&amp;gt;&lt;/span&gt;11&lt;span class=&quot;nt&quot;&gt;&amp;lt;/target&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;/configuration&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/plugin&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/plugins&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/build&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;multi-modules&quot;&gt;Multi-modules&lt;/h1&gt;
&lt;p&gt;Techniquement on peut avoir un projet Java composÃ© dâ€™un seul module (un seul pom.xml), mais au fur et Ã  mesure de lâ€™evolution du projet, une restructuration est necessaire, par exemple les codes qui gere lâ€™accÃ¨s aux donnÃ©es dans un repertoire et les codes qui gerent la logique metier dans un autre repertoire.
Câ€™est pour gÃ©rer ce genre de problematique que Maven propose le multi-module.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;projet-parent
â”œâ”€â”€ pom.xml
    â”œâ”€â”€ module1
         â”œâ”€â”€ pom.xml
    â”œâ”€â”€ module2
         â”œâ”€â”€ pom.xml
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;packaging-avec-jib&quot;&gt;Packaging avec Jib&lt;/h1&gt;

&lt;p&gt;Le packaging est le type dâ€™archivage utilisÃ© pour le projet : jar, war, rar. Avant lâ€™utilisation du Cloud et la conteneurisation, on utilise le war ou la jar pour deployer lâ€™application.&lt;/p&gt;

&lt;p&gt;Avec lâ€™architecture Cloud Native, le packaging final est maintenant une image conteneur (image docker). Cette image peut Ãªtre construite de differente faÃ§on, via un fichier Dockerfile, mais dans le cadre de Maven, on sâ€™interesse au plugi &lt;a href=&quot;https://github.com/GoogleContainerTools/jib&quot;&gt;Jib&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Jib est un plugin Maven developpÃ© par Google qui permet de crÃ©er une image conteneur en mode 100% Java. Via un Dockerfile, on est obligÃ© dâ€™installer lâ€™application Docker parce quâ€™on a besoin du demon docker.&lt;/p&gt;

&lt;h1 id=&quot;astuces&quot;&gt;Astuces&lt;/h1&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mvn help:describe -Ddetail=true -Dplugin=compiler
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mvn help:help -Ddetail=true
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name></name></author><category term="blog" /><summary type="html">Introduction</summary></entry><entry><title type="html">Kubernetes pour les dÃ©veloppeurs</title><link href="https://rasologg.github.io/kubernetes-pour-les-developpeurs/" rel="alternate" type="text/html" title="Kubernetes pour les dÃ©veloppeurs" /><published>2021-04-16T13:33:29+02:00</published><updated>2021-04-16T13:33:29+02:00</updated><id>https://rasologg.github.io/kubernetes-pour-les-developpeurs</id><content type="html" xml:base="https://rasologg.github.io/kubernetes-pour-les-developpeurs/">&lt;h1 id=&quot;quest-ce-quune-image-&quot;&gt;Quâ€™est ce quâ€™une image ?&lt;/h1&gt;

&lt;p&gt;Dans le monde de Kubernetes, une image est une encapsulation dâ€™une application (par exemple un microservice) sous une forme portable, facile Ã  dÃ©ployer. Lâ€™image contient tous les fichiers que lâ€™application a besoin pour fonctionner correctement, et elle est construite Ã  partir dâ€™un mini-noyaux Linux.&lt;/p&gt;

&lt;p&gt;Une fois lancÃ©e, une image devient un conteneur, donc un conteneur est une instance dâ€™une image.&lt;/p&gt;

&lt;p&gt;Il y a plusieurs faÃ§ons de crÃ©er une image :&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;via un fichier Dockerfile&lt;/li&gt;
  &lt;li&gt;via dâ€™autres outils comme &lt;a href=&quot;https://github.com/GoogleContainerTools/jib&quot;&gt;Jib&lt;/a&gt; pour les developpeurs Java.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Voici un exemple dâ€™un Dockerfile :&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;FROM nginx:alpine
MAINTAINER GÃ©gÃ© Rasolo
COPY index.html /usr/share/nginx/html/index.html
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Une image un ensemble des couches et toujours construite Ã  partir dâ€™une autre image. Dans lâ€™exemple ci-dessus, on part de lâ€™image â€œnginx:alpineâ€, qui elle est basÃ©e sur une autre image â€œalpineâ€ et ainsi de suite.&lt;/p&gt;

&lt;p&gt;Si on souhaite construire une image Ã  partir de zero, on utilise lâ€™instruction â€œFROM scratchâ€,  https://hub.docker.com/_/scratch une image vide qui permet de crÃ©er â€œfrom scratchâ€.&lt;/p&gt;

&lt;p&gt;Par exemple, lâ€™image &lt;a href=&quot;https://github.com/docker-library/busybox/blob/master/Dockerfile.template&quot;&gt;busybox&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;FROM scratch
ADD busybox.tar.xz /
CMD [&quot;sh&quot;]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/GoogleContainerTools/jib&quot;&gt;Jib&lt;/a&gt;, est un outil open-source, 100% en Java, developpÃ© par Google, il permet de construire facilement une image sans avoir besoin dâ€™un daemon comme Docker.&lt;/p&gt;

&lt;h1 id=&quot;quest-ce-quun-conteneur-&quot;&gt;Quâ€™est ce quâ€™un conteneur ?&lt;/h1&gt;

&lt;p&gt;Un conteneur est une instance dâ€™une image. Si on compate Ã  la programmation orientÃ© objet, image est un â€œClassâ€, un conteneur est un â€œobjectâ€.&lt;/p&gt;

&lt;p&gt;Le conteneur peut fonctionner sur nâ€™importe quel systÃ¨me compatible, sur nâ€™importe quel Cloud, sans aucun changement.&lt;/p&gt;

&lt;p&gt;Pour demarrer un conteneur, il faut un â€œruntimeâ€, ce conteneur â€œruntimeâ€ permet Ã  lâ€™application (conteneur) de communiquer Ã  la machine hÃ´te et donc dâ€™utiliser les resources necessaires (CPU, RAM, Disque, Reseaux).&lt;/p&gt;

&lt;p&gt;Conteneur runtime : docker, lxc, runc, cri-o, rkt, containerd, podman, buildah.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/kubernetes-developper-application-container.png&quot; alt=&quot;Kubernetes container&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Un conteneur est fortement inspirÃ© des fonctionnalitÃ©s offertes par le systeme Linux.&lt;/p&gt;

&lt;p&gt;Au sein du â€œruntimeâ€, chaque conteneur est isolÃ© par le concept de â€œnamespacesâ€. Cette isolation sâ€™applique sur le reseau (network), fichier (file), utilisateurs (users), processus (processes), et les communications inter-processus (IPCs).&lt;/p&gt;

&lt;p&gt;Lâ€™utilisation dâ€™un conteneur est standardisÃ© et suit la specification dâ€™OCI (Open Containers Initiative) https://opencontainers.org. Ce qui permet de deployer et executer nâ€™importe quel conteneur sur nâ€™impore quel â€œruntimeâ€.&lt;/p&gt;

&lt;p&gt;On peut tÃ©lÃ©charger une image depuis des plateformes comme https://hub.docker.com/, https://quay.io/, et bien dâ€™autres.&lt;/p&gt;

&lt;p&gt;Lâ€™exemple suivant nous montre comment on lance un conteneur Ã  partir de lâ€™image â€œnginx:1.19â€. Sachant que jâ€™utilise le â€œruntimeâ€ docker sur mon ordinateur, le â€œruntimeâ€ tÃ©lÃ©charge automatiquement lâ€™image depuis la plateforme docker.io si lâ€™image nâ€™est pas disponible en local. Câ€™est comme si on Ã©crit (docker.io/nginx:1.19 Ã  la place de nginx:1.19 seulement)&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker run --name mon-serveur-web -d nginx:1.19
Unable to find image 'nginx:1.19' locally
1.19: Pulling from library/nginx
75646c2fb410: Pull complete
6128033c842f: Pull complete
71a81b5270eb: Pull complete
b5fc821c48a1: Pull complete
da3f514a6428: Pull complete
3be359fed358: Pull complete
Digest: sha256:bae781e7f518e0fb02245140c97e6ddc9f5fcf6aecc043dd9d17e33aec81c832
Status: Downloaded newer image for nginx:1.19
99d68c4d2eb755d3c094084d46006c26bf6f32ebf133fe436b9fadc6739b7163
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Et pour vÃ©rifier que notre serveur web Nginx est maintenant lancÃ© :&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker ps
99d68c4d2eb7   nginx:1.19                       &quot;/docker-entrypoint.â€¦&quot;   30 seconds ago   Up 29 seconds   80/tcp    mon-serveur-web
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;kubernetes&quot;&gt;Kubernetes&lt;/h1&gt;

&lt;p&gt;Un systeme dâ€™information contient majoritairement beaucoup dâ€™applications, et donc beaucoup de conteneurs Ã  deployer, Ã§a peut Ãªtre deployÃ©e sur une seule grosse machine (pas vraiment une bonne idÃ©e), Ã§a peut Ãªtre sur plusieures machines en mode cluster ou sur le cloud.&lt;/p&gt;

&lt;p&gt;Plusieurs solutions sont possible mais nous nous interessons sur Kubernetes qui est devenu, de facto, le systeme dâ€™orchestration des conteneurs.&lt;/p&gt;

&lt;p&gt;Mais Ã  titre dâ€™information, on peut utiliser :&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://docs.docker.com/compose/&quot;&gt;Docker compose&lt;/a&gt; permet de dÃ©ployer plusieurs conteneurs sur une seule machine en une seule commande, encore fois, nâ€™est une bonne idÃ©e pour la production.&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://docs.docker.com/engine/swarm/&quot;&gt;Docker swarm&lt;/a&gt; on peut dire que câ€™est le concurrent de Kubernetes, simple Ã  mettre en place.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;DeveloppÃ©e par Google, rendu public en 2014 et premier release en 2015 et maintenant appartient Ã  la fondation Linux. Kubernetes est developpÃ© en &lt;a href=&quot;https://golang.org/&quot;&gt;GoLang&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;https://research.google/pubs/pub43438/&lt;/p&gt;

&lt;p&gt;Comme les projets Linux, il y a beaucoup de distribution de Kubernetes, on peut utiliser la distribution originale â€œKubernetes Vanillaâ€, gÃ©rÃ©e par la communautÃ©,  mais on peut aussi choisir dâ€™autres distributions comme OpenShift de chez RedHat etcâ€¦ https://kubernetes.io/fr/docs/setup/pick-right-solution/&lt;/p&gt;

&lt;p&gt;Si on simplifie, Kubernetes est un RESTful API qui expose toutes les operations possibles Ã  faire sur sa base de donnÃ©es, qui est une base de donnÃ©es NoSQL ETCD.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/kubernetes-developper-application-api-server.png&quot; alt=&quot;Screenshot&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;dashbord&quot;&gt;dashbord&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/&quot;&gt;Kubernest dashboard&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Kubernetes IDE comme &lt;a href=&quot;https://k8slens.dev/&quot;&gt;Lens&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;kubectl&quot;&gt;kubectl&lt;/h2&gt;
&lt;p&gt;Lâ€™outil pour administrer Kubernetes, kubectl est basÃ© sur curl.&lt;/p&gt;

&lt;p&gt;https://kubernetes.io/docs/reference/kubectl/cheatsheet/
https://kubectl.docs.kubernetes.io/&lt;/p&gt;

&lt;h2 id=&quot;curl&quot;&gt;curl&lt;/h2&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl proxy --port=8001 &amp;amp;
curl http://localhost:8001
curl http://localhost:8001/api/v1/namespaces/default/pods
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;architecture-de-kubernetes&quot;&gt;Architecture de Kubernetes&lt;/h1&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/kubernetes-developper-application-architecture.png&quot; alt=&quot;Architecture de Kubernetes&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;lapi-kube-apiserver&quot;&gt;Lâ€™API (kube-apiserver)&lt;/h2&gt;

&lt;p&gt;Toutes les fonctionnalitÃ©s de Kubernetes sont accessible via API RESTful.&lt;/p&gt;

&lt;p&gt;Plusieurs API-Resources : apps, networking, storage, â€¦&lt;/p&gt;

&lt;p&gt;Tous les 3 mois il y a un update dâ€™API, il faut bien identifier la version Ã  utiliser.&lt;/p&gt;

&lt;p&gt;Pour savoir la version de lâ€™API utilisÃ©e par le cluster, il suffit de lancer la commande suivante :&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl api-versions
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;lorchestrateur-kube-scheduler&quot;&gt;Lâ€™orchestrateur (kube-scheduler)&lt;/h2&gt;

&lt;p&gt;//TODO&lt;/p&gt;

&lt;h2 id=&quot;le-controlleur-kube-controller-manager&quot;&gt;Le Controlleur (kube-controller-manager)&lt;/h2&gt;

&lt;p&gt;On peut resumer son rÃ´le avec le bout de code ci-dessous :&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;for {
    desired := getDesiredState()
    current := getCurrentState()
    makeChanges(desired, current)
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;lagent-kubelet&quot;&gt;Lâ€™agent (kubelet)&lt;/h2&gt;

&lt;p&gt;Lâ€™agent de Kubernetes qui se trouvent sur chaque noeuds du clusteur. Cet agent qui recoit et execute les ordres venant de lâ€™orchestrateur. Il remonte aussi toutes les informations au master via lâ€™API et ces informations sont stockÃ©es dans la base de donnÃ©es ETCD.&lt;/p&gt;

&lt;h2 id=&quot;kubeproxy&quot;&gt;kubeproxy&lt;/h2&gt;

&lt;p&gt;//TODO&lt;/p&gt;

&lt;h2 id=&quot;etcd&quot;&gt;ETCD&lt;/h2&gt;

&lt;p&gt;//TODO&lt;/p&gt;

&lt;h1 id=&quot;deployer-un-mini-cluster-kubernetes-pour-le-developpement&quot;&gt;Deployer un mini-cluster Kubernetes pour le developpement&lt;/h1&gt;

&lt;p&gt;Plusieurs solutions sont disponibles :&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.docker.com/products/docker-desktop&quot;&gt;DockerDesktop&lt;/a&gt; : simple et facile Ã  mettre en place pour Windows et MacOS.&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://minikube.sigs.k8s.io/docs/start/&quot;&gt;Minikube&lt;/a&gt; pour Linux, macOS et windows.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Personnellement, je travaille sur DockerDesktop pour macOS&lt;/p&gt;

&lt;h2 id=&quot;quelques-commandes-pour-tester-notre-cluster&quot;&gt;Quelques commandes pour tester notre cluster&lt;/h2&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl version
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Client Version: version.Info{Major:&quot;1&quot;, Minor:&quot;19&quot;, GitVersion:&quot;v1.19.7&quot;, GitCommit:&quot;1dd5338295409edcfff11505e7bb246f0d325d15&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2021-01-13T13:23:52Z&quot;, GoVersion:&quot;go1.15.5&quot;, Compiler:&quot;gc&quot;, Platform:&quot;darwin/amd64&quot;}
Server Version: version.Info{Major:&quot;1&quot;, Minor:&quot;19&quot;, GitVersion:&quot;v1.19.7&quot;, GitCommit:&quot;1dd5338295409edcfff11505e7bb246f0d325d15&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2021-01-13T13:15:20Z&quot;, GoVersion:&quot;go1.15.5&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/amd64&quot;}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Deployer et lancer rapidement un pod (methode imperative)&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl run monnginx --image=nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;pod/monnginx created
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl get all
NAME          READY   STATUS    RESTARTS   AGE
pod/monnginx   1/1     Running   0          3m26s

NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
service/kubernetes   ClusterIP   10.96.0.1    &amp;lt;none&amp;gt;        443/TCP   37m
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;les-principaux-objets-utilisÃ©s-par-kubernetes&quot;&gt;Les principaux objets utilisÃ©s par Kubernetes&lt;/h1&gt;

&lt;h2 id=&quot;pods&quot;&gt;Pods&lt;/h2&gt;
&lt;p&gt;Est une abstration dâ€™un serveur.  Un pod peut contenir plusieurs conteneurs dans un seul namespace et ils sont exposÃ© via une seule adresse IP.&lt;/p&gt;

&lt;p&gt;En production, un pod ne doit pas Ãªtre demarrÃ© tout seul, il ne sera pas redeployer quand le noeud sâ€™arrete. Un pod peut Ãªtre crÃ©Ã© Ã  partir dâ€™un deploiment, job ou cronjob.&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Pod&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;monnginx&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;default&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;monnginx&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;nginx:latest&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl explain pods
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl explain pods.spec
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Generalement, un pod contient un seul conteneur mais, dans certains cas on a besoin de lancer multiples conteneurs dans un pod:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;init container : pour initialiser une configuration par exemple&lt;/li&gt;
  &lt;li&gt;sidecar container : produire des fonctionnalitÃ©s supplementaires au conteneur principal, par exemple gestion des logs, synchronisation, metriques, tracing&lt;/li&gt;
  &lt;li&gt;ambassador container&lt;/li&gt;
  &lt;li&gt;adapter container&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;initcontainers&quot;&gt;InitContainers&lt;/h3&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Pod&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;initcontainer-example&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;initContainers&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;sleepy&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;alpine&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;sleep'&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;20'&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;web&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;nginx&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;comment-investiguer-un-probleme-dans-un-pod-&quot;&gt;Comment investiguer un probleme dans un pod ?&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl describe pod podname 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Lit le status courant du pod dans la base de donnÃ©es etcd.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl logs podname
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Lit le contenu stdout du pod, sâ€™il y a plusieurs conteneurs il faut ajouter lâ€™option -c avec le nom du conteneur&lt;/p&gt;

&lt;p&gt;kubectl exec (executer une commande dans un conteneur, sâ€™il y a plusieurs conteneurs il faut ajouter lâ€™option -c)&lt;/p&gt;

&lt;p&gt;kubectl get pods â€“all-namespaces -o wide&lt;/p&gt;

&lt;h3 id=&quot;securitycontext-dun-pod&quot;&gt;securityContext dâ€™un pod&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-yaml&quot; data-lang=&quot;yaml&quot;&gt;&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Pod&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; 
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;nginxsecure&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;securityContext&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;runAsNonRoot&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;nginx&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;nginx&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;tester-laccessibilitÃ©-dun-pod&quot;&gt;Tester lâ€™accessibilitÃ© dâ€™un pod&lt;/h3&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl port-forward pod/podname port_externe:port_interne
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;limitation-des-resources-utilisÃ©-par-un-pod&quot;&gt;Limitation des resources utilisÃ© par un pod&lt;/h3&gt;

&lt;p&gt;Par defaut un pod utilise autant de CPU et memoire pour faire son travail.
On peut controler lâ€™utilisation des resources via pod.spec.containers.resources.&lt;/p&gt;

&lt;p&gt;CPU : millicore (m), 1000m est lâ€™equivalent dâ€™un 1 CPU.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;requests:
limits:
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;deployments&quot;&gt;Deployments&lt;/h2&gt;

&lt;p&gt;Une entitÃ© pour standardiser la gestion des pods. Un deployment crÃ©e un autre object â€œreplicasetâ€ automatiquement, le â€œreplicasetâ€ est fortement liÃ© Ã  un â€œdeploymentâ€ et donc inutile de le gerer separement.&lt;/p&gt;

&lt;p&gt;Un deploiement permet de gerer le scalabilitÃ© de lâ€™application, la strategie de mise Ã  jour et lâ€™historique.&lt;/p&gt;

&lt;p&gt;Si un pod tombe en panne, le deploiement crÃ©e automatique un autre.&lt;/p&gt;

&lt;p&gt;En production, il faut toujours crÃ©er un pod Ã  partir dâ€™un objet â€œdeploymentâ€.&lt;/p&gt;

&lt;p&gt;Voici la structure dâ€™un fichier YAML â€œdeploymentâ€ :&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-yaml&quot; data-lang=&quot;yaml&quot;&gt;&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;apps/v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Deployment&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;lt;NomApplication&amp;gt;&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;matchLabels&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;lt;NomApplication&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;lt;NomApplication&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;lt;NomApplication&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;lt;Image&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;resources&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;limits&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;memory&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;lt;Memory&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;cpu&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;lt;CPU&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;containerPort&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;lt;Port&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Comme tous les fichiers de Kubernetes, Ã§a commence toujours par la version de lâ€™API (apiVersion). Lâ€™objet de deploiement se trouve donc dans â€œappsâ€.
â€œkindâ€ sera toujours â€œDeploymentâ€.
metadata.name : est le nom de lâ€™application Ã  deployer.
containers.image : est le chemin oÃ¹ se trouve lâ€™image, et la version.&lt;/p&gt;

&lt;p&gt;Voici un exemple complet pour deployer lâ€™application Redis.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-yaml&quot; data-lang=&quot;yaml&quot;&gt;&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;apps/v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Deployment&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;redis&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;matchLabels&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;redis&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;redis&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;redis&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;redis:alpine&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;resources&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;limits&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;memory&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;128Mi&quot;&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;cpu&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;500m&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;containerPort&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;6379&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;â¯ kubectl apply -f redis-deploy.yaml
deployment.apps/redis created
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Verifions si lâ€™application est demarrÃ©e.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;â¯ kubectl get po -l app=redis
NAME                    READY   STATUS    RESTARTS   AGE
redis-d8c6dcd54-726rp   1/1     Running   0          24s
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Ici, lâ€™option â€œ-lâ€ veut dire label, et donc on souhaite juste afficher les pods qui ont un label â€œappâ€ avec la valeur â€œredisâ€. Câ€™est la valeur quâ€™on a indiquÃ© dans le fichier YAML ci-dessus (spec.template.metadata.labels).&lt;/p&gt;

&lt;p&gt;Et maintenant si supprime le pod :&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;â¯ kubectl delete po redis-d8c6dcd54-726rp
pod &quot;redis-d8c6dcd54-726rp&quot; deleted
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;On constate que Kubernetes crÃ©e automatiquement une autre instance :&lt;/p&gt;

&lt;p&gt;redis-d8c6dcd54-726rp                  1/1     Terminating         0          66s
redis-d8c6dcd54-xbx8j                  0/1     ContainerCreating   0          3s&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;â¯ kubectl get po -l app=redis
NAME                    READY   STATUS    RESTARTS   AGE
redis-d8c6dcd54-xbx8j   1/1     Running   0          86s
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;On a dit que lâ€™historique de deploiement est aussi gÃ©rÃ©e par lâ€™object â€œDeploymentâ€.
On peut consulter cette historique via la commande :&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;â¯ kubectl rollout history deployment redis
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Ã§a devrait afficher le resultat suivant :&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;deployment.apps/redis
REVISION  CHANGE-CAUSE
1         &amp;lt;none&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Ici on nâ€™a quâ€™une seule revision parce quâ€™on a rien modifiÃ© pour lâ€™instant.
Kubernetes suit une strategie quand une modification est faite sur le deploiment :&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;la stratÃ©gie â€œRecreateâ€ : Ã§a supprime lâ€™ancien pod et crÃ©e une nouvelle, Ã§a implique une petite indisponibilitÃ© du service.&lt;/li&gt;
  &lt;li&gt;la stratÃ©gie â€œRollingUpdateâ€ : cette stretÃ©gie garantit la disponibilitÃ© de lâ€™application, et donc Kubernetes remplace un pod Ã  la fois.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;On va apporter quelques modifications Ã  notre fichier redis-deploy.yaml pour gÃ©rer la stratÃ©gie de mise Ã  jour et commenÃ§ons par une ancienne version de Redis â€œ5.0.12-alpineâ€ :&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-yaml&quot; data-lang=&quot;yaml&quot;&gt;&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;apps/v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Deployment&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;redis&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;replicas&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;4&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;strategy&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;RollingUpdate&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;rollingUpdate&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;maxSurge&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;maxUnavailable&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;matchLabels&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;redis&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;redis&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;redis&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;redis:5.0.12-alpine&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;resources&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;limits&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;memory&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;128Mi&quot;&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;cpu&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;500m&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;containerPort&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;6379&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;â¯ kubectl apply -f redis-deploy.yaml
deployment.apps/redis configured
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Verifions :&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-`&quot;&gt;â¯ kubectl get po -l app=redis
NAME                    READY   STATUS    RESTARTS   AGE
redis-d8c6dcd54-9bqfl   1/1     Running   0          12s
redis-d8c6dcd54-bjxjf   1/1     Running   0          12s
redis-d8c6dcd54-nnrqs   1/1     Running   0          12s
redis-d8c6dcd54-t8t26   1/1     Running   0          12s
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Maintenant on a bien 4 replicas, comme câ€™est demandÃ© dans le fichier YAML.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;â¯ kubectl rollout history deployment redis
deployment.apps/redis
REVISION  CHANGE-CAUSE
1         &amp;lt;none&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Maintenant, modifions la version de Redis :&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;â¯ kubectl set image deployment.apps/redis redis=redis:6-alpine
deployment.apps/redis image updated
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;VÃ©rifions si la version a Ã©tÃ© mise Ã  jour&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;â¯ kubectl get deployment.apps/redis -o=jsonpath='{$.spec.template.spec.containers[:1].image}'
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;redis:6-alpine
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Et si on reconsulte lâ€™historique, la revision devrait Ãªtre 2 :&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;â¯ kubectl rollout history deployment redis
deployment.apps/redis
REVISION  CHANGE-CAUSE
1         &amp;lt;none&amp;gt;
2         &amp;lt;none&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl rollout history deployment redis --revision=1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;deployment.apps/redis with revision #1
Pod Template:
  Labels:	app=redis
	pod-template-hash=68d544cd59
  Containers:
   redis:
    Image:	redis:5.0.12-alpine
    Port:	6379/TCP
    Host Port:	0/TCP
    Limits:
      cpu:	500m
      memory:	128Mi
    Environment:	&amp;lt;none&amp;gt;
    Mounts:	&amp;lt;none&amp;gt;
  Volumes:	&amp;lt;none
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl rollout history deployment redis --revision=2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;deployment.apps/redis with revision #2
Pod Template:
  Labels:	app=redis
	pod-template-hash=5f7d7d959f
  Containers:
   redis:
    Image:	redis:6-alpine
    Port:	6379/TCP
    Host Port:	0/TCP
    Limits:
      cpu:	500m
      memory:	128Mi
    Environment:	&amp;lt;none&amp;gt;
    Mounts:	&amp;lt;none&amp;gt;
  Volumes:	&amp;lt;none&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;â¯ kubectl get replicasets.apps -l app=redis
NAME               DESIRED   CURRENT   READY   AGE
redis-5f7d7d959f   4         4         4       11m
redis-68d544cd59   0         0         0       15m
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Si on revient en arriere&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;â¯ kubectl rollout undo deployment redis --to-revision=1
deployment.apps/redis rolled back
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;services&quot;&gt;Services&lt;/h2&gt;

&lt;p&gt;Un pod tout seul nâ€™est pas accessible depuis lâ€™exterieur en tant quâ€™application.&lt;/p&gt;

&lt;p&gt;Pour debugger, on peut quand meme utiliser le â€œport forwardâ€, mais ceci nâ€™est pas lâ€™utilisation normale dâ€™une application.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl port-forward pod/mynginx 8989:80
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Forwarding from 127.0.0.1:8989 -&amp;gt; 80
Forwarding from [::1]:8989 -&amp;gt; 80
Handling connection for 8989
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/kubernetes-developper-application-port-forward.png&quot; alt=&quot;Kubernetes port forward&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Pour exposer lâ€™application, il faut crÃ©er un service.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/kubernetes-developper-application-pod-access.png&quot; alt=&quot;Kubernetes pod access&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/kubernetes-developper-application-pod-access-2.png&quot; alt=&quot;Kubernetes pod access&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Il y a plusieurs type de service :&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ClusterIP : le type par dÃ©faut, et il est accessible quâ€™Ã  lâ€™interieur du cluster.&lt;/li&gt;
  &lt;li&gt;NodePort : ouvre le port de lâ€™application sur le noeud, et donc on peut y acceder directement depuis lâ€™exterieur.&lt;/li&gt;
  &lt;li&gt;LoadBalancer : utilisÃ© par le fourniseur cloud public.&lt;/li&gt;
  &lt;li&gt;ExternalName : une sorte de redirection de nom DNS.&lt;/li&gt;
  &lt;li&gt;Service sans â€œselectorâ€ : utilisÃ© pour connecter directement Ã  une IP/port par exemple un serveur de base de donnÃ©es ou une application exterieur au cluster Kubernetes.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Pour exposer un service rapidement via la ligne de commande&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl expose deployment monnginx --port=80 --type=NodePort
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;service/monnginx exposed
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl get service
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;NAME                  TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE
kubernetes            ClusterIP   10.96.0.1        &amp;lt;none&amp;gt;        443/TCP        4d1h
monnginx              NodePort    10.102.160.117   &amp;lt;none&amp;gt;        80:32392/TCP   58s
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Mais crÃ©er un service via la ligne de commande nâ€™est pas vraiment la bonne pratique, il faut plutÃ´t utiliser des fichiers.
Voici un exemple de fichier YAML pour crÃ©er un service :&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Service&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;mon-serveur-web&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;monnginx&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;80&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;mon-serveur-web&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;NodePort&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;â¯ kubectl apply -f nginx-service.yaml
service/mon-serveur-web created
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;ingress&quot;&gt;Ingress&lt;/h2&gt;
&lt;p&gt;//TODO&lt;/p&gt;

&lt;h2 id=&quot;persistent-volumes&quot;&gt;Persistent Volumes&lt;/h2&gt;
&lt;p&gt;//TODO&lt;/p&gt;

&lt;h2 id=&quot;jobs&quot;&gt;Jobs&lt;/h2&gt;

&lt;p&gt;Pour executer une tache pendant un certain temps defini.&lt;/p&gt;

&lt;p&gt;3 differentes type de jobs :&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;non-parallel jobs : completions=1 parallelism=1&lt;/li&gt;
  &lt;li&gt;Parallel jobs : completions=n, parallelism=m&lt;/li&gt;
  &lt;li&gt;Parallel jobs avec un queue : completions=1, parallelism=n&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;cronjobs&quot;&gt;Cronjobs&lt;/h2&gt;

&lt;h2 id=&quot;namespace&quot;&gt;Namespace&lt;/h2&gt;
&lt;p&gt;Pour isoler les ressources dans le cluster. Par dÃ©faut, Kubernetes crÃ©e plusieurs namespaces : default, kube-node-lease, kube-public, kube-system.&lt;/p&gt;

&lt;p&gt;Pour crÃ©er un namespace :&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl create ns ci-env
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Pour lancer une requete dâ€™un namespace, on utilise lâ€™option â€œ-nâ€&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl -n namespace get pods
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Lister tous les namespaces&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl get ns
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl get pods --all-namespaces
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;autorisation-et-permission&quot;&gt;Autorisation et permission&lt;/h1&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl auth can-i get pods
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl auth can-i get pods --as toto@test.com
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;comment-on-developpe-pour-kubernetes-&quot;&gt;Comment on developpe pour Kubernetes ?&lt;/h1&gt;

&lt;p&gt;Build lâ€™application -&amp;gt; La conteneuriser -&amp;gt; La deployer et executer sur K8S&lt;/p&gt;

&lt;h2 id=&quot;developpement-continue-avec-skaffold&quot;&gt;developpement continue avec Skaffold&lt;/h2&gt;
&lt;p&gt;https://skaffold.dev/&lt;/p&gt;

&lt;h1 id=&quot;operator&quot;&gt;Operator&lt;/h1&gt;

&lt;p&gt;un moyen dâ€™etendre les ressources que lâ€™API Serveur de Kubernetes peut gerer. On appelle ceci CRD (Custom Resource Definitions).&lt;/p&gt;</content><author><name></name></author><category term="blog" /><summary type="html">Quâ€™est ce quâ€™une image ?</summary></entry><entry><title type="html">Kubernetes monitoring</title><link href="https://rasologg.github.io/kubernetes-monitoring/" rel="alternate" type="text/html" title="Kubernetes monitoring" /><published>2021-04-01T13:33:29+02:00</published><updated>2021-04-01T13:33:29+02:00</updated><id>https://rasologg.github.io/kubernetes-monitoring</id><content type="html" xml:base="https://rasologg.github.io/kubernetes-monitoring/">&lt;h1 id=&quot;installer-prometheus-operator-pour-kubernetes&quot;&gt;Installer Prometheus Operator pour Kubernetes&lt;/h1&gt;

&lt;p&gt;Installer lâ€™operateur via la ligne de commande suivante, si vous voulez specifier un autre namespace que le default, vous pouvez ajouter le â€œ-n votre_namespaceâ€&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl apply -f https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/master/bundle.yaml
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Ã§a devrait afficher les messages suivants&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;customresourcedefinition.apiextensions.k8s.io/alertmanagerconfigs.monitoring.coreos.com created
customresourcedefinition.apiextensions.k8s.io/alertmanagers.monitoring.coreos.com created
customresourcedefinition.apiextensions.k8s.io/podmonitors.monitoring.coreos.com created
customresourcedefinition.apiextensions.k8s.io/probes.monitoring.coreos.com created
customresourcedefinition.apiextensions.k8s.io/prometheuses.monitoring.coreos.com created
customresourcedefinition.apiextensions.k8s.io/prometheusrules.monitoring.coreos.com created
customresourcedefinition.apiextensions.k8s.io/servicemonitors.monitoring.coreos.com created
customresourcedefinition.apiextensions.k8s.io/thanosrulers.monitoring.coreos.com created
clusterrolebinding.rbac.authorization.k8s.io/prometheus-operator created
clusterrole.rbac.authorization.k8s.io/prometheus-operator created
deployment.apps/prometheus-operator created
serviceaccount/prometheus-operator created
service/prometheus-operator created
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Pour vÃ©rifier que lâ€™operateur est bien installÃ©&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl get deploy
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;NAME                  READY   UP-TO-DATE   AVAILABLE   AGE
prometheus-operator   0/1     1            0           10s
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Maintenant on peut configurer le RBAC, afin dâ€™autoriser Prometheus Ã  acceder Ã  lâ€™API de Kubernetes.
CrÃ©er un fichier prometheus_rbac.yaml et ajouter le contenu ci-dessus :&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ServiceAccount&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;prometheus&lt;/span&gt;
&lt;span class=&quot;nn&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;rbac.authorization.k8s.io/v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ClusterRole&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;prometheus&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;rules&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;apiGroups&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;resources&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;nodes&lt;/span&gt;
  &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;nodes/metrics&lt;/span&gt;
  &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;services&lt;/span&gt;
  &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;endpoints&lt;/span&gt;
  &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;pods&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;verbs&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;get&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;list&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;watch&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;apiGroups&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;resources&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;configmaps&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;verbs&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;get&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;apiGroups&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;networking.k8s.io&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;resources&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ingresses&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;verbs&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;get&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;list&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;watch&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;nonResourceURLs&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/metrics&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;verbs&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;get&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;nn&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;rbac.authorization.k8s.io/v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ClusterRoleBinding&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;prometheus&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;roleRef&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;apiGroup&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;rbac.authorization.k8s.io&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ClusterRole&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;prometheus&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;subjects&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ServiceAccount&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;prometheus&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;default&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Ensuite, executer la commande suivante&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl apply -f prometheus_rbac.yaml
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;On devrait avoir des messages comme ci-dessous&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;serviceaccount/prometheus created
clusterrole.rbac.authorization.k8s.io/prometheus created
clusterrolebinding.rbac.authorization.k8s.io/prometheus created
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;CrÃ©er un fichier YAML pour deployer prometheus (par exemple prometheus.yaml) contenant le code ci-dessous&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;monitoring.coreos.com/v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Prometheus&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;prometheus&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;prometheus&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;quay.io/prometheus/prometheus:v2.22.1&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;nodeSelector&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;kubernetes.io/os&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;linux&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;replicas&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;resources&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;requests&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;memory&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;400Mi&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;securityContext&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;fsGroup&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;2000&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;runAsNonRoot&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;runAsUser&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1000&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;serviceAccountName&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;prometheus&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;v2.22.1&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;serviceMonitorSelector&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;{}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ensuite, lancer la commande&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl apply -f prometheus.yaml
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;prometheus.monitoring.coreos.com/prometheus created
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;On vÃ©rifie&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl get prometheus
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;On devrait obtenir le resultat suivant&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;NAME         VERSION   REPLICAS   AGE
prometheus   v2.22.1   2          12s
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Et une autre commande&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl get pod -l app=prometheus
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Et un autre resultat :-)&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;NAME                      READY   STATUS    RESTARTS   AGE
prometheus-prometheus-0   2/2     Running   1          69s
prometheus-prometheus-1   2/2     Running   1          69s
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Et une derniere Ã©tape pour exposer le service afin que prometheus soit accessible via Grafana. 
CrÃ©er un autre fichier YAML, nommer le comme vous le voulez, par prometheus_service.yaml&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Service&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;prometheus&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;prometheus&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;web&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;9090&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;targetPort&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;web&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;prometheus&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;sessionAffinity&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ClientIP&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Et on applique le fichier&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl apply -f prometheus_service.yaml
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;qui devrait afficher ce message&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;service/prometheus created
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Et on vÃ©rifie si tout va bien&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl get service
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;NAME                  TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)    AGE
kubernetes            ClusterIP   10.96.0.1        &amp;lt;none&amp;gt;        443/TCP    72m
prometheus            ClusterIP   10.107.134.128   &amp;lt;none&amp;gt;        9090/TCP   11s
prometheus-operated   ClusterIP   None             &amp;lt;none&amp;gt;        9090/TCP   2m26s
prometheus-operator   ClusterIP   None             &amp;lt;none&amp;gt;        8080/TCP   5m56s
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Et voilÃ , on a un prometheus UP&amp;amp;RUNNING ;-) mais sans Grafana le travail nâ€™est pas bien fait.&lt;/p&gt;

&lt;p&gt;Pour installer Grafana, on passe par Helm, il faut installer Helm si vous ne lâ€™avez pas encore.&lt;/p&gt;

&lt;p&gt;Ajoutons le repo de bitnami&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;helm repo add bitnami https://charts.bitnami.com/bitnami
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Ensuite, on installe grafana, en mode quickstart ;-)&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;helm install grafana bitnami/grafana
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Ã§a devrait afficher un message de ce type&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;NAME: grafana
LAST DEPLOYED: Thu Apr  8 17:32:32 2021
NAMESPACE: default
STATUS: deployed
REVISION: 1
TEST SUITE: None
NOTES:
** Please be patient while the chart is being deployed **

1. Get the application URL by running these commands:
    echo &quot;Browse to http://127.0.0.1:8080&quot;
    kubectl port-forward svc/grafana 8080:3000 &amp;amp;

2. Get the admin credentials:

    echo &quot;User: admin&quot;
    echo &quot;Password: $(kubectl get secret grafana-admin --namespace default -o jsonpath=&quot;{.data.GF_SECURITY_ADMIN_PASSWORD}&quot; | base64 --decode)&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name></name></author><category term="blog" /><summary type="html">Installer Prometheus Operator pour Kubernetes</summary></entry><entry><title type="html">Kubernetes: gestion de secrets</title><link href="https://rasologg.github.io/kubernetes-secrets/" rel="alternate" type="text/html" title="Kubernetes: gestion de secrets" /><published>2021-03-16T12:33:29+01:00</published><updated>2021-03-16T12:33:29+01:00</updated><id>https://rasologg.github.io/kubernetes-secrets</id><content type="html" xml:base="https://rasologg.github.io/kubernetes-secrets/">&lt;h1 id=&quot;la-gestion-des-secrets-dans-kubernetes-Ã -lÃ©poque-de-gitops&quot;&gt;La gestion des secrets dans Kubernetes Ã  lâ€™Ã©poque de GitOps&lt;/h1&gt;

&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;
&lt;p&gt;Ces derniers temps, on attend de plus en plus parler de GitOps avec Kubernetes. Grosso modo, GitOps, câ€™est tout gÃ©rer via Git, 
les fichiers de configuration, les fichiers de description de dÃ©ploiement, et donc par consÃ©quent les identifiants et mot de passe que les applications ont besoin pour fonctionner, 
par exemple lâ€™identifiant et mot de passe pour la base de donnÃ©es.&lt;/p&gt;

&lt;p&gt;Mettre ces informations directement sur Git nâ€™est pas vraiment une bonne idÃ©e, de point de vue sÃ©curitÃ©, et beaucoup dâ€™entreprise continue Ã  gÃ©rer les secrets manuellement via une commande kubectl et stocker les identifiants et mot de passe dans un outil comme keepass.
Et ceci dÃ©roge au concept de GitOps.&lt;/p&gt;

&lt;p&gt;Pour rÃ©pondre Ã  ce problÃ©matique que la fondation CNCF Ã©tudie les outils suivants afin de les inclure dans lâ€™Ã©co-systÃ¨me cloud-native :&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.vaultproject.io/&quot;&gt;Hashicorp Vault&lt;/a&gt;, &lt;a href=&quot;https://aws.amazon.com/fr/secrets-manager/&quot;&gt;AWS Secrets Manager&lt;/a&gt;, Certificate Manager, AWS KMS&lt;/li&gt;
  &lt;li&gt;Bitnami Sealed Secret, Encrypted repositories&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://cloud.google.com/solutions/secrets-management&quot;&gt;Google Secrets Management&lt;/a&gt;, &lt;a href=&quot;https://github.com/mozilla/sops&quot;&gt;Sops&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Plus dâ€™info :
https://www.cncf.io/announcements/2021/02/23/cncf-provides-insights-into-secrets-management-tools-with-latest-end-user-technology-radar/&lt;/p&gt;</content><author><name></name></author><category term="blog" /><summary type="html">La gestion des secrets dans Kubernetes Ã  lâ€™Ã©poque de GitOps</summary></entry><entry><title type="html">Python : developper avec Flask</title><link href="https://rasologg.github.io/developper-avec-python-flask/" rel="alternate" type="text/html" title="Python : developper avec Flask" /><published>2021-01-15T12:33:29+01:00</published><updated>2021-01-15T12:33:29+01:00</updated><id>https://rasologg.github.io/developper-avec-python-flask</id><content type="html" xml:base="https://rasologg.github.io/developper-avec-python-flask/">&lt;h2 id=&quot;developper-un-site-web-avec-python-flask&quot;&gt;Developper un site web avec Python Flask&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;Installer Python. Un tutoriel interessant se trouve ici &lt;a href=&quot;https://realpython.com/installing-python&quot;&gt;RealPython&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;CrÃ©er le repertoire de votre projet&lt;/li&gt;
  &lt;li&gt;Entrer dans le repertoire et crÃ©er lâ€™environnement virtuel (virtual env), comme suit :
    &lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;python3 &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; venv venv
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;p&gt;Le deuxieme â€œvenvâ€ peut Ãªtre nâ€™importe quoi, par exemple le nom du projet&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;Activer le virtual env :
    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;source venv/bin/activate
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;p&gt;Une fois lâ€™environnement virtuel est crÃ©Ã© et activÃ©, on nâ€™a plus besoin de specifier la version de python, comme python3 ou pip3
juste Ã©crire python, pip et Ã§a marchera&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;CrÃ©er un fichier nommÃ© requirements.txt et ajouter la ligne :
    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;flask
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;CrÃ©er un autre fichier requirements-dev.txt
    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-r requirements.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;Installer le framework
    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;pip install flask
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;p&gt;Si vous utiliser un outil de developpement comme PyCharm, il detecte automatiquement le contenu du fichier requirements.txt et installe le framework Ã  votre place&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;Maintenant, vous pouvez commencer Ã  Ã©crire votre premier programme, commencez par crÃ©er un fichier, par exemple app.py, Ã  lâ€™interieur de ce fichier, ecrire le code ci-dessous :&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;flask&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;app&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;flask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Flask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__name__&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;route&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'/'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Bonjour le monde !&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;On sauvegarde et on peut lancer le programme. Tout dâ€™abord, il faut specifier deux variables dâ€™environnement FLASK_APP et FLASK_ENV&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;export FLASK_APP=app #app correspond au nom de fichier qu'on a crÃ©Ã© ci-dessus
export FLASK_ENV=development
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;ul&gt;
  &lt;li&gt;Maintenant, on lance le programme
    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;flask run
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Par dÃ©faut, Flask Ã©coute sur le port 5000, si on souhaite specifier un autre si le 5000 est dÃ©jÃ  utilisÃ©&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;flask run -p 5001
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name></name></author><category term="blog" /><summary type="html">Developper un site web avec Python Flask</summary></entry></feed>